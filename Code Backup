let ships=[];

var Fly_101 = '{"name":"Fly","level":1,"model":1,"size":1.05,"specs":{"shield":{"capacity":[75,100],"reload":[2,3]},"generator":{"capacity":[40,60],"reload":[10,15]},"ship":{"mass":60,"speed":[125,145],"rotation":[110,130],"acceleration":[100,120]}},"bodies":{"main":{"section_segments":12,"offset":{"x":0,"y":0,"z":10},"position":{"x":[0,0,0,0,0,0,0,0,0,0],"y":[-65,-60,-50,-20,10,30,55,75,60],"z":[0,0,0,0,0,0,0,0,0]},"width":[0,8,10,30,25,30,18,15,0],"height":[0,6,8,12,20,20,18,15,0],"propeller":true,"texture":[4,63,10,1,1,1,12,17]},"OI1l1":{"section_segments":12,"offset":{"x":0,"y":0,"z":20},"position":{"x":[0,0,0,0,0,0,0],"y":[-15,0,20,30,60],"z":[0,0,0,0,0]},"width":[0,13,17,10,5],"height":[0,18,25,18,5],"propeller":false,"texture":[7,9,9,4,4]},"cannon":{"section_segments":6,"offset":{"x":0,"y":-15,"z":-10},"position":{"x":[0,0,0,0,0,0],"y":[-40,-50,-20,0,20,30],"z":[0,0,0,0,0,20]},"width":[0,5,8,11,7,0],"height":[0,5,8,11,10,0],"angle":0,"laser":{"damage":[5,6],"rate":4,"type":1,"speed":[160,180],"number":1,"error":2.5},"propeller":false,"texture":[3,3,10,3]}},"wings":{"main":{"length":[60,20],"width":[100,50,40],"angle":[-10,10],"position":[0,20,10],"doubleside":true,"offset":{"x":0,"y":10,"z":5},"bump":{"position":30,"size":20},"texture":[11,63]}},"typespec":{"name":"Fly","level":1,"model":1,"code":101,"specs":{"shield":{"capacity":[75,100],"reload":[2,3]},"generator":{"capacity":[40,60],"reload":[10,15]},"ship":{"mass":60,"speed":[125,145],"rotation":[110,130],"acceleration":[100,120]}},"shape":[1.368,1.368,1.093,0.965,0.883,0.827,0.791,0.767,0.758,0.777,0.847,0.951,1.092,1.667,1.707,1.776,1.856,1.827,1.744,1.687,1.525,1.415,1.335,1.606,1.603,1.578,1.603,1.606,1.335,1.415,1.525,1.687,1.744,1.827,1.856,1.776,1.707,1.667,1.654,0.951,0.847,0.777,0.758,0.767,0.791,0.827,0.883,0.965,1.093,1.368],"lasers":[{"x":0,"y":-1.365,"z":-0.21,"angle":0,"damage":[5,6],"rate":4,"type":1,"speed":[160,180],"number":1,"spread":0,"error":2.5,"recoil":0}],"radius":1.856}}';
ships.push(Fly_101);
var Shadow_X_2_601 = '{"name":"Shadow X-2","level":6,"model":1,"size":1.1,"specs":{"shield":{"capacity":[150,220],"reload":[5,7]},"generator":{"capacity":[80,145],"reload":[19,29]},"ship":{"mass":125,"speed":[110,140],"rotation":[35,48],"acceleration":[140,160]}},"bodies":{"main":{"section_segments":10,"offset":{"x":0,"y":0,"z":0},"position":{"x":[0,0,0,0,0,0,0,0,0,0,0,0],"y":[-100,-98,-95,-70,-40,0,40,70,80,90,100],"z":[0,0,0,0,0,0,0,0,0,0,0]},"width":[0,5,10,20,30,20,20,30,30,30,20,0],"height":[0,4,4,20,20,10,10,15,15,15,10,10],"texture":[12,5,63,4,4,3,4,4,5]},"back":{"section_segments":10,"offset":{"x":0,"y":0,"z":0},"position":{"x":[0,0,0,0,0],"y":[90,95,100,105,90],"z":[0,0,0,0,0]},"width":[10,15,18,19,2],"height":[3,5,7,8,2],"texture":[63],"propeller":true},"cockpit":{"section_segments":8,"offset":{"x":0,"y":-25,"z":12},"position":{"x":[0,0,0,0,0,0],"y":[-45,-40,-25,0,5],"z":[0,0,0,0,0,0]},"width":[0,10,15,5,0],"height":[0,10,15,5,0],"texture":[9]},"laser":{"section_segments":10,"offset":{"x":50,"y":10,"z":-13},"position":{"x":[0,0,0,0,0,0,0,0,0,0],"y":[-30,-25,0,10,20,25,30,40,70,60],"z":[0,0,0,0,0,0,0,0,0,0]},"width":[0,10,15,15,15,10,10,15,10,0],"height":[0,10,15,15,15,10,10,15,5,0],"texture":[6,4,10,3,4,3,2],"propeller":true,"laser":{"damage":[5,7],"rate":5,"type":1,"speed":[160,190],"number":1}}},"wings":{"top":{"doubleside":true,"offset":{"x":10,"y":60,"z":5},"length":[30],"width":[50,30],"angle":[60],"position":[0,50],"texture":[3],"bump":{"position":10,"size":10}},"side":{"doubleside":true,"offset":{"x":10,"y":70,"z":5},"length":[30],"width":[40,20],"angle":[-13],"position":[0,60],"texture":[63],"bump":{"position":10,"size":10}},"wings":{"offset":{"x":0,"y":35,"z":0},"length":[80],"width":[100,70],"angle":[0],"position":[-80,50],"texture":[4],"bump":{"position":10,"size":15}}},"typespec":{"name":"Shadow X-2","level":6,"model":1,"code":601,"specs":{"shield":{"capacity":[150,220],"reload":[5,7]},"generator":{"capacity":[80,145],"reload":[19,29]},"ship":{"mass":125,"speed":[110,140],"rotation":[35,48],"acceleration":[140,160]}},"shape":[2.2,2.141,1.787,1.481,1.272,1.135,1.076,1.035,1.016,1.188,1.343,1.35,1.371,1.416,1.46,1.564,1.887,2.17,2.405,2.753,3.16,2.084,2.79,3.199,2.656,2.315,2.656,3.199,2.79,2.084,3.16,2.753,2.405,2.17,1.887,1.564,1.46,1.416,1.372,1.35,1.343,1.188,1.016,1.035,1.076,1.135,1.272,1.481,1.787,2.141],"lasers":[{"x":1.1,"y":-0.44,"z":-0.286,"angle":0,"damage":[5,7],"rate":5,"type":1,"speed":[160,190],"number":1,"spread":0,"error":0,"recoil":0},{"x":-1.1,"y":-0.44,"z":-0.286,"angle":0,"damage":[5,7],"rate":5,"type":1,"speed":[160,190],"number":1,"spread":0,"error":0,"recoil":0}],"radius":3.199}}';
ships.push(Shadow_X_2_601);
var Shadow_X_4_602 = '{"name":"Shadow X-4","level":6,"model":2,"size":1.1,"zoom":0.7,"specs":{"shield":{"capacity":[150,220],"reload":[5,7]},"generator":{"capacity":[400,750],"reload":[250,350]},"ship":{"mass":125,"speed":[110,250],"rotation":[35,100],"acceleration":[140,250]}},"bodies":{"main":{"section_segments":10,"offset":{"x":0,"y":0,"z":0},"position":{"x":[0,0,0,0,0,0,0,0,0,0,0,0],"y":[-100,-98,-95,-70,-40,0,40,70,80,90,100],"z":[0,0,0,0,0,0,0,0,0,0,0]},"width":[0,5,10,20,30,20,20,30,30,30,20,0],"height":[0,4,4,20,20,10,10,15,15,15,10,10],"texture":[12,5,4,4,4,3,4,4,5]},"back":{"section_segments":10,"offset":{"x":0,"y":0,"z":0},"position":{"x":[0,0,0,0,0],"y":[90,95,100,105,90],"z":[0,0,0,0,0]},"width":[10,15,18,19,2],"height":[3,5,7,8,2],"texture":[5],"propeller":true},"cockpit":{"section_segments":8,"offset":{"x":0,"y":-25,"z":12},"position":{"x":[0,0,0,0,0,0],"y":[-45,-40,-25,0,5],"z":[0,0,0,0,0,0]},"width":[0,10,15,5,0],"height":[0,10,15,5,0],"texture":[9]},"laser":{"section_segments":10,"offset":{"x":50,"y":10,"z":-13},"position":{"x":[0,0,0,0,0,0,0,0,0,0],"y":[-30,-25,0,10,20,25,30,40,70,60],"z":[0,0,0,0,0,0,0,0,0,0]},"width":[0,10,15,15,15,10,10,15,10,0],"height":[0,10,15,15,15,10,10,15,5,0],"texture":[6,4,10,3,4,3,2],"propeller":true,"laser":{"damage":[50,70],"rate":10,"type":1,"recoil":200,"speed":[160,190],"number":1}}},"wings":{"top":{"doubleside":true,"offset":{"x":10,"y":60,"z":5},"length":[30],"width":[50,30],"angle":[60],"position":[0,50],"texture":[3],"bump":{"position":10,"size":10}},"side":{"doubleside":true,"offset":{"x":10,"y":70,"z":5},"length":[30],"width":[40,20],"angle":[-13],"position":[0,60],"texture":[5],"bump":{"position":10,"size":10}},"wings":{"offset":{"x":0,"y":35,"z":0},"length":[80],"width":[100,70],"angle":[0],"position":[-80,50],"texture":[4],"bump":{"position":10,"size":15}}},"typespec":{"name":"Shadow X-4","level":6,"model":2,"code":602,"specs":{"shield":{"capacity":[150,220],"reload":[5,7]},"generator":{"capacity":[400,750],"reload":[250,350]},"ship":{"mass":125,"speed":[110,250],"rotation":[35,100],"acceleration":[140,250]}},"shape":[2.2,2.141,1.787,1.481,1.272,1.135,1.076,1.035,1.016,1.188,1.343,1.35,1.371,1.416,1.46,1.564,1.887,2.17,2.405,2.753,3.16,2.084,2.79,3.199,2.656,2.315,2.656,3.199,2.79,2.084,3.16,2.753,2.405,2.17,1.887,1.564,1.46,1.416,1.372,1.35,1.343,1.188,1.016,1.035,1.076,1.135,1.272,1.481,1.787,2.141],"lasers":[{"x":1.1,"y":-0.44,"z":-0.286,"angle":0,"damage":[50,70],"rate":10,"type":1,"speed":[160,190],"number":1,"spread":0,"error":0,"recoil":200},{"x":-1.1,"y":-0.44,"z":-0.286,"angle":0,"damage":[50,70],"rate":10,"type":1,"speed":[160,190],"number":1,"spread":0,"error":0,"recoil":200}],"radius":3.199}}';
ships.push(Shadow_X_4_602);
var A_Speedster_605 = '{"name":"A-Speedster","level":6,"model":5,"size":1.5,"specs":{"shield":{"capacity":[200,300],"reload":[6,8]},"generator":{"capacity":[80,140],"reload":[30,45]},"ship":{"mass":165,"speed":[90,130],"rotation":[40,70],"acceleration":[90,120]}},"bodies":{"main":{"section_segments":8,"offset":{"x":0,"y":0,"z":0},"position":{"x":[0,0,0,0,0,0],"y":[-100,-95,0,0,70,65],"z":[0,0,0,0,0,0]},"width":[0,10,40,20,20,0],"height":[0,5,30,30,15,0],"texture":[6,11,5,63,12],"propeller":true,"laser":{"damage":[38,84],"rate":1,"type":2,"speed":[150,205],"recoil":50,"number":1,"error":0}},"OI1l1":{"section_segments":8,"offset":{"x":0,"y":-60,"z":15},"position":{"x":[0,0,0,0,0,0,0],"y":[-20,0,20,40,50],"z":[-7,-5,0,0,0]},"width":[0,10,10,10,0],"height":[0,10,15,12,0],"texture":[9]},"side_propulsors":{"section_segments":10,"offset":{"x":50,"y":25,"z":0},"position":{"x":[0,0,0,0,0,0,0,0,0,0],"y":[-20,-15,0,10,20,25,30,40,80,70],"z":[0,0,0,0,0,0,0,0,0,0]},"width":[0,15,20,20,20,15,15,20,10,0],"height":[0,15,20,20,20,15,15,20,10,0],"propeller":true,"texture":[4,4,2,2,5,63,5,4,12]},"IIIO0":{"section_segments":12,"offset":{"x":30,"y":40,"z":45},"position":{"x":[0,0,0,0,0,0,0],"y":[-50,-45,-20,0,20,30,40],"z":[0,0,0,0,0,0,0]},"width":[0,5,7,10,3,5,0],"height":[0,5,7,8,3,5,0],"angle":-10,"laser":{"damage":[8,12],"rate":2,"type":1,"speed":[100,130],"number":1,"angle":-10,"error":0},"propeller":false,"texture":[6,4,10,4,63,4]}},"wings":{"join":{"offset":{"x":0,"y":0,"z":10},"length":[40,0],"width":[10,20],"angle":[-1],"position":[0,30],"texture":[63],"bump":{"position":0,"size":25}},"ll0I1":{"offset":{"x":0,"y":-40,"z":10},"doubleside":true,"length":[45,10],"width":[5,20,30],"angle":[50,-10],"position":[90,80,50],"texture":[4],"bump":{"position":10,"size":30}}},"typespec":{"name":"A-Speedster","level":6,"model":5,"code":605,"specs":{"shield":{"capacity":[200,300],"reload":[6,8]},"generator":{"capacity":[80,140],"reload":[30,45]},"ship":{"mass":165,"speed":[90,130],"rotation":[40,70],"acceleration":[90,120]}},"shape":[3,2.914,2.408,1.952,1.675,1.49,1.349,1.263,1.198,1.163,1.146,1.254,1.286,1.689,2.06,2.227,2.362,2.472,2.832,3.082,3.436,3.621,3.481,2.48,2.138,2.104,2.138,2.48,3.481,3.621,3.436,3.082,2.832,2.472,2.362,2.227,2.06,1.689,1.286,1.254,1.146,1.163,1.198,1.263,1.349,1.49,1.675,1.952,2.408,2.914],"lasers":[{"x":0,"y":-3,"z":0,"angle":0,"damage":[38,84],"rate":1,"type":2,"speed":[150,205],"number":1,"spread":0,"error":0,"recoil":50},{"x":1.16,"y":-0.277,"z":1.35,"angle":-10,"damage":[8,12],"rate":2,"type":1,"speed":[100,130],"number":1,"spread":-10,"error":0,"recoil":0},{"x":-1.16,"y":-0.277,"z":1.35,"angle":10,"damage":[8,12],"rate":2,"type":1,"speed":[100,130],"number":1,"spread":-10,"error":0,"recoil":0}],"radius":3.621}}';
ships.push(A_Speedster_605);
var No_Regen_606 = '{"name":"No-Regen","level":6,"model":6,"size":1.5,"specs":{"shield":{"capacity":[200,300],"reload":[0,0.01]},"generator":{"capacity":[80,140],"reload":[30,45]},"ship":{"mass":175,"speed":[90,115],"rotation":[60,80],"acceleration":[90,140]}},"bodies":{"main":{"section_segments":8,"offset":{"x":0,"y":0,"z":0},"position":{"x":[0,0,0,0,0,0],"y":[-100,-95,0,0,70,65],"z":[0,0,0,0,0,0]},"width":[0,10,40,20,20,0],"height":[0,5,30,30,15,0],"texture":[6,11,5,63,12],"propeller":true,"laser":{"damage":[38,84],"rate":1,"type":2,"speed":[175,230],"recoil":50,"number":1,"error":0}},"cockpit":{"section_segments":8,"offset":{"x":0,"y":-60,"z":15},"position":{"x":[0,0,0,0,0,0,0],"y":[-20,0,20,40,50],"z":[-7,-5,0,0,0]},"width":[0,10,10,10,0],"height":[0,10,15,12,0],"texture":[9]},"side_propulsors":{"section_segments":10,"offset":{"x":50,"y":25,"z":0},"position":{"x":[0,0,0,0,0,0,0,0,0,0],"y":[-20,-15,0,10,20,25,30,40,80,70],"z":[0,0,0,0,0,0,0,0,0,0]},"width":[0,15,20,20,20,15,15,20,10,0],"height":[0,15,20,20,20,15,15,20,10,0],"propeller":true,"texture":[4,4,2,2,5,63,5,4,12]},"cannons":{"section_segments":12,"offset":{"x":30,"y":40,"z":45},"position":{"x":[0,0,0,0,0,0,0],"y":[-50,-45,-20,0,20,30,40],"z":[0,0,0,0,0,0,0]},"width":[0,5,7,10,3,5,0],"height":[0,5,7,8,3,5,0],"angle":-10,"laser":{"damage":[8,12],"rate":2,"type":1,"speed":[100,130],"number":1,"angle":-10,"error":0},"propeller":false,"texture":[6,4,10,4,63,4]}},"wings":{"join":{"offset":{"x":0,"y":0,"z":10},"length":[40,0],"width":[10,20],"angle":[-1],"position":[0,30],"texture":[63],"bump":{"position":0,"size":25}},"winglets":{"offset":{"x":0,"y":-40,"z":10},"doubleside":true,"length":[45,10],"width":[5,20,30],"angle":[50,-10],"position":[90,80,50],"texture":[4],"bump":{"position":10,"size":30}}},"typespec":{"name":"No-Regen","level":6,"model":6,"code":606,"specs":{"shield":{"capacity":[200,300],"reload":[0,0.01]},"generator":{"capacity":[80,140],"reload":[30,45]},"ship":{"mass":175,"speed":[90,115],"rotation":[60,80],"acceleration":[90,140]}},"shape":[3,2.914,2.408,1.952,1.675,1.49,1.349,1.263,1.198,1.163,1.146,1.254,1.286,1.689,2.06,2.227,2.362,2.472,2.832,3.082,3.436,3.621,3.481,2.48,2.138,2.104,2.138,2.48,3.481,3.621,3.436,3.082,2.832,2.472,2.362,2.227,2.06,1.689,1.286,1.254,1.146,1.163,1.198,1.263,1.349,1.49,1.675,1.952,2.408,2.914],"lasers":[{"x":0,"y":-3,"z":0,"angle":0,"damage":[38,84],"rate":1,"type":2,"speed":[175,230],"number":1,"spread":0,"error":0,"recoil":50},{"x":1.16,"y":-0.277,"z":1.35,"angle":-10,"damage":[8,12],"rate":2,"type":1,"speed":[100,130],"number":1,"spread":-10,"error":0,"recoil":0},{"x":-1.16,"y":-0.277,"z":1.35,"angle":10,"damage":[8,12],"rate":2,"type":1,"speed":[100,130],"number":1,"spread":-10,"error":0,"recoil":0}],"radius":3.621}}';
ships.push(No_Regen_606);
var A_OP_607 = '{"name":"A-OP","level":6,"model":7,"size":1.5,"specs":{"shield":{"capacity":[200,300],"reload":[6,8]},"generator":{"capacity":[800,1400],"reload":[380,840]},"ship":{"mass":175,"speed":[90,115],"rotation":[60,80],"acceleration":[90,140]}},"bodies":{"main":{"section_segments":8,"offset":{"x":0,"y":0,"z":0},"position":{"x":[0,0,0,0,0,0],"y":[-100,-95,0,0,70,65],"z":[0,0,0,0,0,0]},"width":[0,10,40,20,20,0],"height":[0,5,30,30,15,0],"texture":[6,11,5,3,12],"propeller":true,"laser":{"damage":[38,84],"rate":10,"type":2,"speed":[175,230],"recoil":50,"number":1,"error":0}},"cockpit":{"section_segments":8,"offset":{"x":0,"y":-60,"z":15},"position":{"x":[0,0,0,0,0,0,0],"y":[-20,0,20,40,50],"z":[-7,-5,0,0,0]},"width":[0,10,10,10,0],"height":[0,10,15,12,0],"texture":[9]},"side_propulsors":{"section_segments":10,"offset":{"x":50,"y":25,"z":0},"position":{"x":[0,0,0,0,0,0,0,0,0,0],"y":[-20,-15,0,10,20,25,30,40,80,70],"z":[0,0,0,0,0,0,0,0,0,0]},"width":[0,15,20,20,20,15,15,20,10,0],"height":[0,15,20,20,20,15,15,20,10,0],"propeller":true,"texture":[4,4,2,2,5,3,5,4,12]},"cannons":{"section_segments":12,"offset":{"x":30,"y":40,"z":45},"position":{"x":[0,0,0,0,0,0,0],"y":[-50,-45,-20,0,20,30,40],"z":[0,0,0,0,0,0,0]},"width":[0,5,7,10,3,5,0],"height":[0,5,7,8,3,5,0],"angle":-10,"laser":{"damage":[8,12],"rate":10,"type":1,"speed":[100,130],"number":1,"angle":-10,"error":0},"propeller":false,"texture":[6,4,10,4,63,4]}},"wings":{"join":{"offset":{"x":0,"y":0,"z":10},"length":[40,0],"width":[10,20],"angle":[-1],"position":[0,30],"texture":[3],"bump":{"position":0,"size":25}},"winglets":{"offset":{"x":0,"y":-40,"z":10},"doubleside":true,"length":[45,10],"width":[5,20,30],"angle":[50,-10],"position":[90,80,50],"texture":[4],"bump":{"position":10,"size":30}}},"typespec":{"name":"A-OP","level":6,"model":7,"code":607,"specs":{"shield":{"capacity":[200,300],"reload":[6,8]},"generator":{"capacity":[800,1400],"reload":[380,840]},"ship":{"mass":175,"speed":[90,115],"rotation":[60,80],"acceleration":[90,140]}},"shape":[3,2.914,2.408,1.952,1.675,1.49,1.349,1.263,1.198,1.163,1.146,1.254,1.286,1.689,2.06,2.227,2.362,2.472,2.832,3.082,3.436,3.621,3.481,2.48,2.138,2.104,2.138,2.48,3.481,3.621,3.436,3.082,2.832,2.472,2.362,2.227,2.06,1.689,1.286,1.254,1.146,1.163,1.198,1.263,1.349,1.49,1.675,1.952,2.408,2.914],"lasers":[{"x":0,"y":-3,"z":0,"angle":0,"damage":[38,84],"rate":10,"type":2,"speed":[175,230],"number":1,"spread":0,"error":0,"recoil":50},{"x":1.16,"y":-0.277,"z":1.35,"angle":-10,"damage":[8,12],"rate":10,"type":1,"speed":[100,130],"number":1,"spread":-10,"error":0,"recoil":0},{"x":-1.16,"y":-0.277,"z":1.35,"angle":10,"damage":[8,12],"rate":10,"type":1,"speed":[100,130],"number":1,"spread":-10,"error":0,"recoil":0}],"radius":3.621}}';
ships.push(A_OP_607);
//game.ships[0].set({type:607,stats:88888888,crystals:719})

let area1=0;
let area2=0;
let area3=0;
let area4=0;
let a1ships=[];
let a3ship=-1;
let a4ship=-1;
let startTime3=0;
let startTime4=0;
let Next3=-1;
let Next4=-1;
let angle=0;
let alienup=2;
let duelA=2;
let COD=-1;

map=
"                                                                                \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                                                                \n"+
"     999    9999999    999                            999    9999999    999     \n"+
"     99   999     999   99                            99   999     999   99     \n"+
"     9 9 99         99 9 9                            9 9 99         99 9 9     \n"+
"        99           99                                  99           99        \n"+
"       99             99                                99             99       \n"+
"      99               99                              99               99      \n"+
"      9                 9                              9                 9      \n"+
"     99                 99                            99                 99     \n"+
"     9                   9                            9                   9     \n"+
"     9                   9                            9                   9     \n"+
"     9                   9                            9                   9     \n"+
"     9                   9                            9                   9     \n"+
"     9                   9                            9                   9     \n"+
"     99                 99                            99                 99     \n"+
"      9                 9                              9                 9      \n"+
"      99               99                              99               99      \n"+
"       99             99                                99             99       \n"+
"        99           99                                  99           99        \n"+
"     9 9 99         99 9 9                            9 9 99         99 9 9     \n"+
"     99   999     999   99                            99   999     999   99     \n"+
"     999    9999999    999                            999    9999999    999     \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                 9999      9999                                 \n"+
"                                 9  999  999  9                                 \n"+
"                                 9    9  9    9                                 \n"+
"                                 99   9999   99                                 \n"+
"                                  9          9                                  \n"+
"                                  999      999                                  \n"+
"                                    9      9                                    \n"+
"                                    9      9                                    \n"+
"                                  999      999                                  \n"+
"                                  9          9                                  \n"+
"                                 99   9999   99                                 \n"+
"                                 9    9  9    9                                 \n"+
"                                 9  999  999  9                                 \n"+
"                                 9999      9999                                 \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                                                                \n"+
"     999    9999999    999                            999    9999999    999     \n"+
"     99   999     999   99                            99   999     999   99     \n"+
"     9 9 99         99 9 9                            9 9 99         99 9 9     \n"+
"        99           99                                  99           99        \n"+
"       99             99                                99             99       \n"+
"      99               99                              99               99      \n"+
"      9                 9                              9                 9      \n"+
"     99                 99                            99                 99     \n"+
"     999999999999999999999                            9                   9     \n"+
"     9                   9                            9                   9     \n"+
"     9                   9                            9                   9     \n"+
"     9                   9                            9                   9     \n"+
"     999999999999999999999                            9                   9     \n"+
"     99                 99                            99                 99     \n"+
"      9                 9                              9                 9      \n"+
"      99               99                              99               99      \n"+
"       99             99                                99             99       \n"+
"        99           99                                  99           99        \n"+
"     9 9 99         99 9 9                            9 9 99         99 9 9     \n"+
"     99   999     999   99                            99   999     999   99     \n"+
"     999    9999999    999                            999    9999999    999     \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                                                                \n"+
"                                                                                ";

const VOCABULARY = [
    // 1
    {text: "You",       icon: "\u004e", key: "O"},
    {text: "Me",        icon: "\u004f", key: "E"},
    {text: "Hmm",       icon: "\u004b", key: "Q"},
    {text: "Yes",       icon: "\u004c", key: "Y"},
    // 2
    {text: "No",        icon: "\u004d", key: "N"},
    {text: "Hello",     icon: "\u0045", key: "H"},
    {text: "Sorry",     icon: "\u00a1", key: "S"},
    {text: "Attack",    icon: "\u0049", key: "A"},
    // 3
    {text: "Follow Me", icon: "\u0050", key: "F"},
    {text: "Good Game", icon: "\u00a3", key: "G"},
    {text: "Kill",      icon: "\u007f", key: "K"},
    {text: "High Score",icon: "\u002e", key: "I"},
    // 4
    {text: "",    icon: "\u{1F913}", key: "L"},
    {text: "",    icon: "\u{1F928}", key:"Z"},
    {text: "",    icon: "\u{1F97A}", key:"X"},
    {text: "",    icon: "\u{1F389}", key:"P"},
    // 5
    {text: "Duel Area",     icon: "\u00be", key: "D"},
    {text: "Alien Area",    icon: "\u0030", key: "M"},
    {text: "Tunnel Area",   icon: "\u0062", key: "B"},
    {text: "Circle Area",   icon: "\u23E3", key: "J"},
    // 6
    {text: "",   icon: "\u{1D7CF}", key: "1"},
    {text: "",   icon: "\u{1D7D0}", key: "2"},
    {text: "",   icon: "\u{1D7D1}", key: "3"},
    {text: "",   icon: "\u{1D7D2}", key: "4"},
    // 7
    {text: "",   icon: "\u{1D7D3}", key: "5"},
    {text: "",   icon: "\u{1D7D4}", key: "6"},
    {text: "",   icon: "\u{1D7D5}", key: "7"},
    {text: "",   icon: "\u{1D7D6}", key: "8"},
    // 8
    {text: "",   icon: "\u{1D7D7}", key: "9"},
    {text: "",   icon: "\u{1D7CE}", key: "0"}
];
//Button data
var Regen_button = {
  id: "Regen",
  position: [76, 1, 3.5, 5.5],
  clickable: true,
  shortcut: "R",
  visible: false,
  components: [
    { type:"box",position:[0,0,100,100],fill:"#456",stroke:"#CDE",width:2},
    { type: "text",position:[10,35,80,30],value:"Next Ship",color:"#CDE"},
    { type: "text",position:[20,70,60,20],value:"[R]",color:"#CDE"}
    ]
};

var A_Speed_button = {
  id: "A_Speed",
  position: [72, 1, 3.5, 5.5],
  clickable: true,
  shortcut: "T",
  visible: true,
  components: [
    { type:"box",position:[0,0,100,100],fill:"#456",stroke:"#CDE",width:2},
    { type: "text",position:[10,35,80,30],value:"A-Speed",color:"#CDE"},
    { type: "text",position:[20,70,60,20],value:"[T]",color:"#CDE"}
    ]
};

var Return_button = {
  id: "Return",
  position: [68, 1, 3.5, 5.5],
  clickable: true,
  shortcut: "W",
  visible: true,
  components: [
    { type:"box",position:[0,0,100,100],fill:"#456",stroke:"#CDE",width:2},
    { type: "text",position:[10,35,80,30],value:"Return",color:"#CDE"},
    { type: "text",position:[20,70,60,20],value:"[W]",color:"#CDE"}
    ]
};
//button functions
var Regen = function(ship) {
  if (((ship.x*ship.x)+(ship.y*ship.y))<=8100)
  {
  ship.set({type:607});
  ship.set({stats:88888888, crystals:719, shield: 1000});
  }
} ;

var A_Speed = function(ship) {
  if (((ship.x*ship.x)+(ship.y*ship.y))<=8100)
  {
    ship.set({type:605, stats:88888888, crystals:719, shield: 1000});
  }
};

var Return = function(ship) {
  ship.set({type:605});
  ship.set({x:0,y:0,vx:0,vy:0,shield:3000,stats:88888888});
  shipCount();
  COD=game.step+30
};
//custom functions
var shipCount = function() {
  area1=0;
  a1ships=[];
  area2=0;
  area3=0;
  area4=0;
  for (var i=0;i<game.ships.length;i++)
  {
    if (((((game.ships[i].x-250)*(game.ships[i].x-250))+((game.ships[i].y+250)*(game.ships[i].y+250))))<=10000)
    {
      area4=area4+1;
    }
    if (((((game.ships[i].x+250)*(game.ships[i].x+250))+((game.ships[i].y+250)*(game.ships[i].y+250))))<=10000)
    {
      area3=area3+1;
    }
    if (((((game.ships[i].x-250)*(game.ships[i].x-250))+((game.ships[i].y-250)*(game.ships[i].y-250))))<=10000)
    {
      area2=area2+1;
    }
    if (((((game.ships[i].x+250)*(game.ships[i].x+250))+((game.ships[i].y-250)*(game.ships[i].y-250))))<=14400)
    {
      area1=area1+1;
      a1ships.push(i);
    }
  }
  if (area4===0)
  {
    a4ship=-1;
  }
  if (area3===0)
  {
    a3ship=-1;
  }
};

var remAst = function(ship)
{
  if (((((ship.x-250)*(ship.x-250))+((ship.y+250)*(ship.y+250))))<=10000)
  {
    Next4=-1;
    for (var l=game.asteroids.length-1;l>0;l--)
    {
      echo(l);
      if (((((game.asteroids[l].x-250)*(game.asteroids[l].x-250))+((game.asteroids[l].y+250)*(game.asteroids[l].y+250))))<=10000)
      {
        game.asteroids[l].set({kill:true});
      }
    }
  }
};

var newCircle = function()
{
  angle=360*Math.random();
  let vx=0.05*(game.ships[a4ship].x-(85*Math.cos(angle)+245));
  let vy=0.05*(game.ships[a4ship].y-(85*Math.sin(angle)-245));
  let vt=Math.sqrt((vx*vx)+(vy*vy));
  let vg=1.5-(10000/((game.step-startTime4)+9000));
  let size=((game.step-startTime4)/720)+10;
  vx=vx/(vt/vg);
  vy=vy/(vt/vg);
  game.addAsteroid({x:(85*Math.cos(angle)+245),y:(85*Math.sin(angle)-245),size:size,vx:(vx),vy:(vy)});
  Next4=game.step+Math.floor(1000000/(game.step-startTime4+3333));
  game.ships[a4ship].set({score:game.ships[a4ship].score+(Math.floor(1000000/(game.step-startTime4+3333)))});
};

var customObj = function()
{
  game.removeObject()
  
  game.setObject({
  id: "center",
  type: center,
  position: {x:0,y:0,z:0},
  rotation: {x:0,y:0,z:0},
  scale: {x:1,y:1,z:1}
  }) ;
  
  game.setObject({
  id: "startArea",
  type: startArea,
  position: {x:-160,y:-245,z:0},
  rotation: {x:0,y:0,z:0},
  scale: {x:1,y:1,z:1}
  }) ;
  
  game.setObject({
  id: "endArea",
  type: endArea,
  position: {x:-335,y:-245,z:0},
  rotation: {x:0,y:0,z:0},
  scale: {x:1,y:1,z:1}
  }) ;
  
  if (area1>1)
  {
    game.setObject({
    id: "blocked1",
    type: blocked,
    position: {x:-50,y:50,z:0},
    rotation: {x:0,y:0,z:0},
    scale: {x:1,y:1,z:1}
    }) ;
  }
  
  if (area3>0)
  {
    game.setObject({
    id: "blocked3",
    type: blocked,
    position: {x:-50,y:-50,z:0},
    rotation: {x:0,y:0,z:0},
    scale: {x:1,y:1,z:1}
    }) ;
  }

  if (area4>0)
  {
    game.setObject({
    id: "blocked4",
    type: blocked,
    position: {x:50,y:-50,z:0},
    rotation: {x:0,y:0,z:0},
    scale: {x:1,y:1,z:1}
    }) ;
  }
};

var newLine = function()
{
  let vg=1.5-(10000/((game.step-startTime3)+9000));
  game.addAsteroid({x:-155,y:(20*Math.random()-255),size:15,vx:(-vg),vy:0});
  Next3=game.step+Math.floor(1000000/(game.step-startTime3+3333));
  game.ships[a3ship].set({score:game.ships[a3ship].score+(Math.floor(1000000/(game.step-startTime3+3333)))});
}

//objects
var redX = {
  id: "redX",
  obj: "https://raw.githubusercontent.com/Eman-Bman/starblast-aim-training/refs/heads/main/redX.obj",
  emissiveColor: 0xFF0000
};

var greenY = {
  id: "greenY",
  obj: "https://raw.githubusercontent.com/Eman-Bman/starblast-aim-training/refs/heads/main/greenY.obj",
  emissiveColor: 0x00FF00
};
  
var blocked = {
  id: "blocked",
  obj: "https://raw.githubusercontent.com/Eman-Bman/starblast-aim-training/refs/heads/main/blocked.obj",
  emissiveColor: 0xF0F0FF
};

var startArea = {
  id: "startArea",
  obj: "https://raw.githubusercontent.com/Eman-Bman/starblast-aim-training/refs/heads/main/startArea.obj",
  emissiveColor: 0xFF9900
}

var endArea = {
  id: "endArea",
  obj: "https://raw.githubusercontent.com/Eman-Bman/starblast-aim-training/refs/heads/main/endArea.obj",
  emissiveColor: 0xFF0000
}

var center = {
  id: "center",
  obj: "https://raw.githubusercontent.com/Eman-Bman/starblast-aim-training/refs/heads/main/Center_Base.obj",
  emissiveColor: 0xF0F0FF
};


this.options = {
  soundtrack: "argon.mp3",
  root_mode: "",
  map_name: "Aim Training Test",
  custom_map: map,
  vocabulary: VOCABULARY,
  lives: 5,
  radar_zoom: 1,
  weapons_store: false,
  asteroids_strength: 6,
  starting_ship:800,
  ships: ships,
  reset_tree:true,
  map_size: 80
};

this.tick = function(game) {
  //set initial objects
  if (game.step==60)
  {
    customObj();
  }
  if (game.step>=150 && area4>0 && game.step==Next4)
  {
    newCircle();
  }
  if (game.step>=150 && area3>0 && game.step==Next3)
  {
    newLine();
  }
  if (game.step%120===0)
  {
    shipCount();
    if (duelA==2 && area1==2)
    {
      angle=360*Math.random();
      game.ships[a1ships[0]].set({x:(85*Math.cos(angle)-245),y:(85*Math.sin(angle)+245),invulnerable:60,shield:999,crystals:720});
      game.ships[a1ships[1]].set({x:(85*Math.cos(angle-180)-245),y:(85*Math.sin(angle-180)+245),invulnerable:60,shield:999,crystals:720});
      duelA=3;
    }
    if (duelA==3 && area1!=2)
    {
      duelA=2;
    }
    for (var i=0;i<game.ships.length;i++)
    {
      var ship = game.ships[i] ;
      //install buttons
      if (!ship.custom.Regen_button_installed)
      {
        ship.custom.Regen_button_installed = true;
        ship.setUIComponent(Regen_button);
      }
      if (!ship.custom.A_Speed_button_installed)
      {
        ship.custom.A_Speed_button_installed = true;
        ship.setUIComponent(A_Speed_button);
      }
      if (!ship.custom.Return_button_installed)
      {
        ship.custom.Return_button_installed = true;
        ship.setUIComponent(Return_button);
      }
      //move from lobby to outside
      if (((((game.ships[i].x-50)*(game.ships[i].x-50))+((game.ships[i].y-50)*(game.ships[i].y-50))))<=100)
      {
        //area2
        game.ships[i].set({x:250,y:250,invulnerable:300});
        game.aliens[0].set({rate:1,regen:0,shield:1020,damage:84,laser_speed:205});
        area2=area2+1
      }
      if (((((game.ships[i].x+50)*(game.ships[i].x+50))+((game.ships[i].y+50)*(game.ships[i].y+50))))<=100)
      {
        //area 3
        if (area3===0) {
        game.ships[i].set({x:-250,y:-250,invulnerable:300,score:0,crystals:0,type:606,stats:88888888});
        a3ship=i;
        startTime3=game.step;
        Next3=game.step+300;
        area3=area3+1
        customObj();
        }
      }
      if (((((game.ships[i].x+50)*(game.ships[i].x+50))+((game.ships[i].y-50)*(game.ships[i].y-50))))<=100)
      {
        //area1
        if (area1<=1) {
        game.ships[i].set({x:-250,y:250,invulnerable:300});
        area1=area1+1
        customObj();
        }
      }
      if (((((game.ships[i].x-50)*(game.ships[i].x-50))+((game.ships[i].y+50)*(game.ships[i].y+50))))<=100)
      {
        //area4
        if (area4===0) {
        game.ships[i].set({x:250,y:-250,invulnerable:300,score:0,crystals:0,type:606,stats:88888888,crytals:719});
        a4ship=i;
        startTime4=game.step;
        Next4=game.step+300;
        area4=area4+1
        customObj();
        }
      }
    }
  }
  if (game.step%30===0)
  {
    if (game.aliens.length===0)
    {
    game.addAlien({x:250,y:250,code:12,level:0,points:0,crystal_drop:720});
    alienup=3;
    //game.aliens[0].set({rate:1,regen:0,shield:1020,damage:84,laser_speed:205});
    }
    else
    {
      if (((((game.aliens[0].x-250)*(game.aliens[0].x-250))+((game.aliens[0].y-250)*(game.aliens[0].y-250))))>=10000)
      {
      game.aliens[0].set({kill:true});
      }
    }
  }
  if (game.step%10===0)
  {
    for (var k=0;k<game.asteroids.length;k++)
    {
      if (game.asteroids[k].x<-330)
      {
        game.asteroids[k].set({kill:true})
        if (area3==1)
        {
          if (game.ships[a3ship].shield>50)
          {
            game.ships[a3ship].set({shield:game.ships[a3ship].shield-50})
          }
          else
          {
            game.ships[a3ship].set({kill:true})
            Next3=1
          }
        }
      }
    }
  }
  if (game.step%30==15 && alienup==3)
  {
    game.aliens[0].set({rate:1,regen:0,shield:1020,damage:84,laser_speed:205});
    alienup=2
  }
  if (game.step%10===0)
  {
    for (var j=0;j<game.ships.length;j++)
    {
      if (game.ships[j].crystals>719)
      {
        game.ships[j].set({crystals:719});
      }
    }
  }
  if (game.step==COD)
  {
    shipCount();
    customObj();
  }
};

this.event = function(event,game) {
  let ship = event.ship;
  let killer = event.killer;
  let ast = event.asteroid;
  switch (event.name){
    case "ui_component_clicked":
      var component = event.id ;
      if (component == "Regen")
      {
        Regen(ship);
      }
      if (component == "A_Speed")
      {
        A_Speed(ship);
      }
      if (component == "Return")
      {
        Return(ship);
      }
      break ;
    case "ship_spawned":
      echo("new spawn");
      ship.set({x:0,y:0,type:605, stats:88888888, crystals:720, shield: 1000});
      break ;
    case "asteroid_destroyed":
      killer.set({score:killer.score+1000});
      break ;
    case "ship_destroyed":
      echo("new death");
      COD=game.step+15
      remAst(ship);
      shipCount();
      break;
  }
} ;
